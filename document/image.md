# 数据格式 InImage 说明
## 创建与销毁
InImage 由 factory 提供创建与销毁的函数，在创建时 Net 时，申请相应的 InImage 缓存，并在销毁 Net 时伴随 Net 消亡。

用户层只能由 Net 获取输入输出的Image，并用 vUpload 上传数据， vDownload 下载数据，不能直接访问 Image 中的内容。

## 数据维度
InImage 包括四个维度：width, height, depth, batch, 顺序与 caffe 的 blob 四个维度相反。

当 blob 的维数小于4时，没有指定的维度视为1，如：

dim: {1, 4} -> width=1, height=1, depth=4, batch=1

dim: {1, 4, 5} -> width=1, height=5, depth=4, batch=1

## 数据排列
对输入和输出（vUpload，vDownload 中的 float 数组），InImage 要求数据按 OpenGL 的三维纹理(RGBA32F)排列：

depth 向上4对齐，然后除4，得到 depthQuad

然后数据由外而内的维度就如下：

```
batch
depthQuad
height
width
rgba(4)
```
### 例子1
```
w=2, h=2, d=3, b=1
Caffe：
{
    1.0 , 1.1 , 2.0 , 2.1 ,
    1.01, 1.11, 2.01, 2.11,
    1.02, 1.12, 2.02, 2.12,
}

InImage：
{
    1.0, 1.01, 1.02, 0.0,
    1.1, 1.11, 1.12, 0.0,
    2.0, 2.01, 2.02, 0.0,
    2.1, 2.11, 2.12, 0.0,
}
```

### 例子2
```
w=2, h=2, d=5, b=1
Caffe：
{
    1.0 , 1.1 , 2.0 , 2.1 ,
    1.01, 1.11, 2.01, 2.11,
    1.02, 1.12, 2.02, 2.12,
    1.03, 1.13, 2.03, 2.13,
    1.04, 1.14, 2.04, 2.14,
}

InImage：
{
    1.0 , 1.01, 1.02, 1.03,
    1.1 , 1.11, 1.12, 1.13,
    2.0 , 2.01, 2.02, 2.03,
    2.1 , 2.11, 2.12, 2.13,
    1.04, 0   , 0   , 0   ,
    1.14, 0   , 0   , 0   ,
    2.04, 0   , 0   , 0   ,
    2.14, 0   , 0   , 0   ,
}
```
